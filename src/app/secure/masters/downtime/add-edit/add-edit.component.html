<div class="row justify-content-center">
  <div class="col-xl-11 col-lg-12">
      <div class="border p30 rounded">
          <div class="row align-items-center mb-4">
              <div class="col-lg-7 col-sm-9 col-xs-10 d-flex align-items-end">
                  <h4 class="mb-0"><i class="icon-edit"></i> Add/Edit Downtime Tracking</h4>
              </div>
              <div class="col-lg-5 col-sm-3 col-xs-2 d-flex justify-content-end">
                  <a *authPermission="page + '_' + permissions.list" mat-flat-button color="primary"
                      class="app-button" (click)="cancel()">
                      View List
                  </a>
              </div>
          </div>
          <form [formGroup]="downtimeTrackingForm" (submit)="save()" #form="ngForm" novalidate class="app-form">
              <!-- Basic Details Section -->
              <div class="card mb-4">
                  <div class="card-header">
                      <h5 class="mb-0">Downtime Tracking Header</h5>
                  </div>
                  <div class="card-body">
                      <div class="row">
                          <!-- Code -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>Code</mat-label>
                                  <input matInput formControlName="Code" [disabled]="true">
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.Code"
                                      [message]="'Code'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>

                          <!-- Production Date Time -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>Production Date Time</mat-label>
                                  <input matInput [matDatepicker]="pickerProductionDateTime" formControlName="ProductionDateTime">
                                  <mat-datepicker-toggle matSuffix [for]="pickerProductionDateTime"></mat-datepicker-toggle>
                                  <mat-datepicker #pickerProductionDateTime></mat-datepicker>
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.ProductionDateTime"
                                      [message]="'Production Date Time'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>

                          <!-- Product -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>Product</mat-label>
                                  <mat-select formControlName="ProductId" [disabled]="isEditMode">
                                      <mat-option *ngFor="let product of productList" [value]="product.id">
                                          {{ product.productName }}
                                      </mat-option>
                                  </mat-select>
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.ProductId"
                                      [message]="'Product'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>

                          <!-- Product Line -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>Product Line</mat-label>
                                  <mat-select formControlName="ProductLineId" [disabled]="isEditMode">
                                      <mat-option *ngFor="let productLine of productList" [value]="productLine.id">
                                          {{ productLine.productName }}
                                      </mat-option>
                                  </mat-select>
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.ProductLineId"
                                      [message]="'Product Line'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>

                          <!-- SAP Production Order ID -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>SAP Production Order ID</mat-label>
                                  <input matInput formControlName="SAPProductionOrderId">
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.SAPProductionOrderId"
                                      [message]="'SAP Production Order ID'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>

                          <!-- Is Active -->
                          <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                              <mat-form-field appearance="fill" class="full-width">
                                  <mat-label>Is Active</mat-label>
                                  <mat-select formControlName="IsActive">
                                      <mat-option [value]="true">Yes</mat-option>
                                      <mat-option [value]="false">No</mat-option>
                                  </mat-select>
                                  <mat-validation-message [control]="downtimeTrackingForm.controls.IsActive"
                                      [message]="'Is Active'"
                                      [formSubmitted]="isFormSubmitted"></mat-validation-message>
                              </mat-form-field>
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Downtime Tracking Details Section -->
              <div class="card mb-4">
                  <div class="card-header d-flex align-items-center justify-content-between">
                      <h5 class="mb-0">Downtime Tracking Details</h5>
                  </div>
                  <div class="card-body">
                      <div formArrayName="downtimeTrackingDetails">
                          <div *ngFor="let detail of downtimeTrackingDetails?.controls; let i = index"
                              [formGroupName]="i" class="row mt-3">
                              <div class="row">
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Start Date</mat-label>
                                          <input matInput [matDatepicker]="startDatePicker" formControlName="StartDate">
                                          <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                                          <mat-datepicker #startDatePicker></mat-datepicker>
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>End Date</mat-label>
                                          <input matInput [matDatepicker]="endDatePicker" formControlName="EndDate">
                                          <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                                          <mat-datepicker #endDatePicker></mat-datepicker>
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Durations</mat-label>
                                          <input matInput formControlName="Durations">
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Cause</mat-label>
                                          <mat-select formControlName="CauseId">
                                              <mat-option *ngFor="let cause of causeList" [value]="cause.id">
                                                  {{ cause.causeName }}
                                              </mat-option>
                                          </mat-select>
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Action Taken</mat-label>
                                          <input matInput formControlName="ActionTaken">
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Action Taken ID</mat-label>
                                          <input matInput formControlName="ActionTakenId">
                                      </mat-form-field>
                                  </div>
                                  <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3">
                                      <mat-form-field appearance="fill" class="full-width">
                                          <mat-label>Is Active</mat-label>
                                          <mat-select formControlName="IsActive">
                                              <mat-option [value]="true">Yes</mat-option>
                                              <mat-option [value]="false">No</mat-option>
                                          </mat-select>
                                      </mat-form-field>
                                  </div>

                                  <div class="col-12 col-sm-12 col-md-2 col-lg-2 mb-3 p-1 d-flex align-items-center">
                                      <button type="button" mat-icon-button color="warn" (click)="addFinalDowntimeDetail()">
                                          <mat-icon>add</mat-icon>
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="row">
                  <div class="col-md-12">
                      <div class="table-responsive">
                          <table id="gridDowntimeTracking"
                              class="table table-hover table-bordered display mb-30 fixed-table-scroll-inner"
                              style="overflow:scroll;width:auto">
                              <thead class="bg-primary text-primary text-center">
                                  <tr>
                                      <th style="width:12%">Start Date</th>
                                      <th style="width:12%">End Date</th>
                                      <th>Durations</th>
                                      <th>Cause</th>
                                      <th>Action Taken</th>
                                      <th>Action Taken ID</th>
                                      <th>Is Active</th>
                                      <th style="width:5%">Action</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <tr *ngFor="let detail of downtimeTrackingDetailsList; let i = index">
                                      <td>{{ detail.StartDate }}</td>
                                      <td>{{ detail.EndDate }}</td>
                                      <td>{{ detail.Durations }}</td>
                                      <td>{{ getCauseName(detail.CauseId) }}</td>
                                      <td>{{ detail.ActionTaken }}</td>
                                      <td>{{ detail.ActionTakenId }}</td>
                                      <td>{{ detail.IsActive ? 'Yes' : 'No' }}</td>
                                      <td>
                                          <button (click)="onEditDetail(detail, i)" type="button"
                                              class="btn btn-primary btn-sm btnModifyRow">
                                              <i class="fa fa-pencil"></i>
                                          </button>
                                      </td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                  </div>
              </div>

              <div class="row">
                  <div class="col-lg-12 text-center">
                      <button type="submit" mat-flat-button color="primary" class="app-button mr-1">Save</button>
                  </div>
              </div>
          </form>
      </div>
  </div>
</div>
