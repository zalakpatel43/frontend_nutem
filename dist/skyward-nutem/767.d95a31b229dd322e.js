"use strict";(self.webpackChunkskyward_nutem=self.webpackChunkskyward_nutem||[]).push([[767],{6441:(O,R,n)=>{n.d(R,{L:()=>e});var p=n(4438),u=n(4532),d=n(8498);let e=(()=>{class m{constructor(c,f){this.permissionService=c,this.router=f}canActivate(c,f){return!!this.permissionService.hasPermission(c.data.permission)||(this.router.navigate(["/unauthorized"]),!1)}static#e=this.\u0275fac=function(f){return new(f||m)(p.KVO(u.n),p.KVO(d.Ix))};static#t=this.\u0275prov=p.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},4767:(O,R,n)=>{n.r(R),n.d(R,{RoleModule:()=>X});var p=n(1774),u=n(177),d=n(8498),e=n(4438);let m=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["ng-component"]],decls:1,vars:0,template:function(i,o){1&i&&e.nrm(0,"router-outlet")},dependencies:[d.n3],encapsulation:2})}return s})();var l=n(9417),c=n(4434),f=n(2558),b=n(5794),I=n(4532),E=n(8834),w=n(2765),C=n(2102),S=n(9631),y=n(8777);function T(s,h){if(1&s){const t=e.RV6();e.j41(0,"a",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.cancel())}),e.EFF(1," View List "),e.k0s()}}function M(s,h){1&s&&(e.j41(0,"mat-error"),e.EFF(1," Role Name is required. "),e.k0s())}function x(s,h){if(1&s&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.nrm(4,"mat-checkbox",26),e.k0s(),e.j41(5,"td"),e.nrm(6,"mat-checkbox",26),e.k0s(),e.j41(7,"td"),e.nrm(8,"mat-checkbox",26),e.k0s(),e.j41(9,"td"),e.nrm(10,"mat-checkbox",26),e.k0s()()),2&s){const t=h.$implicit;e.R7$(2),e.JRh(t.get("permission").value),e.R7$(2),e.Y8G("formControl",t.get("view")),e.R7$(2),e.Y8G("formControl",t.get("add")),e.R7$(2),e.Y8G("formControl",t.get("edit")),e.R7$(2),e.Y8G("formControl",t.get("delete"))}}let _=(()=>{class s{constructor(t,i,o,r,a,g){this.activatedRoute=t,this.router=i,this.formBuilder=o,this.roleService=r,this.notificationService=a,this.permissionService=g,this.page=c.Wt.role,this.IsViewPermission=!1,this.Permissions=[{permission:"Dashboard",view:!1,add:!1,edit:!1,delete:!1},{permission:"User",view:!1,add:!1,edit:!1,delete:!1},{permission:"Role",view:!1,add:!1,edit:!1,delete:!1},{permission:"Weight Check",view:!1,add:!1,edit:!1,delete:!1},{permission:"Attribute Check",view:!1,add:!1,edit:!1,delete:!1},{permission:"PreCheck List",view:!1,add:!1,edit:!1,delete:!1},{permission:"PostCheck List",view:!1,add:!1,edit:!1,delete:!1},{permission:"Liquid Preparation",view:!1,add:!1,edit:!1,delete:!1},{permission:"Trailer Loading",view:!1,add:!1,edit:!1,delete:!1},{permission:"Trailer Inspection",view:!1,add:!1,edit:!1,delete:!1},{permission:"Pallet Packing",view:!1,add:!1,edit:!1,delete:!1},{permission:"DownTime Tracking",view:!1,add:!1,edit:!1,delete:!1},{permission:"Production Order",view:!1,add:!1,edit:!1,delete:!1}],this.createForm()}ngOnInit(){this.getRoleRoute(),this.getPermissionDetails(),this.IsViewPermission=this.permissionService.hasPermission("Role (PER_ROLE) - View")}getRoleRoute(){this.routerSub=this.activatedRoute.params.subscribe(t=>{this.isEditMode=!c.ov.isEmpty(t.id),this.isEditMode&&(this.roleId=+t.id,this.getRoleDetails())})}getPermissionDetails(){this.roleService.getPermission(this.permissionId).subscribe(t=>{if(this.PermissionData=t,this.roleData){const i=this.transformPermissionsEdit(this.roleData.rolePermissions,this.PermissionData);this.setRoleData(i)}},t=>{console.error(t),this.notificationService.error("Error fetching permission details: "+t.message)})}getRoleDetails(){this.roleService.getRoleById(this.roleId).subscribe(t=>{if(this.roleData=t,this.roleData&&this.PermissionData){const i=this.transformPermissionsEdit(this.roleData.rolePermissions,this.PermissionData);this.setRoleData(i)}},t=>{console.error(t),this.notificationService.error("Error fetching role details: "+t.message)})}createForm(){this.frmRole=this.formBuilder.group({name:["",[l.k0.required,l.k0.maxLength(100)]],Permissions:this.formBuilder.array(this.Permissions.map(t=>this.createPermissionGroup(t)))})}transformPermissionsEdit(t,i){const o=new Map;i.forEach(a=>{o.set(a.id,{name:a.name,type:a.permissionTypeId})});const r=this.Permissions.map(a=>({...a,view:!1,add:!1,edit:!1,delete:!1}));return t.forEach(a=>{const g=o.get(a.permissionId);if(g){const v=r.find(z=>z.permission===g.name);if(v)switch(g.type){case 72:v.add=!0;break;case 73:v.edit=!0;break;case 74:v.view=!0;break;case 75:v.delete=!0}}}),r}setRoleData(t){this.frmRole.patchValue({name:this.roleData.name});const i=this.frmRole.get("Permissions");i.clear(),t.forEach(o=>{i.push(this.formBuilder.group({permission:[o.permission],view:[o.view],add:[o.add],edit:[o.edit],delete:[o.delete]}))})}createRole(){const t=this.frmRole.value,i=this.transformPermissions(t.Permissions),o={id:0,name:t.name,Permissions:i,rolePermissions:i,assignedPermissions:[],NormalizedName:t.name.toUpperCase()};this.roleService.addRole(o).subscribe(()=>{this.cancel(),this.notificationService.success("Role created successfully.")},r=>{this.error=r,this.notificationService.error("Error creating role: "+r.message)})}createPermissionGroup(t){return this.formBuilder.group({permission:[t.permission],view:[t.view],add:[t.add],edit:[t.edit],delete:[t.delete]})}updateRole(){const t=this.frmRole.value,i=this.transformPermissions(t.Permissions),o={...this.roleData,name:t.name,Permissions:i,NormalizedName:t.name.toUpperCase()};this.roleService.updateRole(this.roleData.id,o).subscribe(()=>{this.cancel(),this.notificationService.success("Role updated successfully.")},r=>{this.error=r,this.notificationService.error("Error updating role: "+r.message)})}transformPermissions(t){return t.map(i=>({Code:this.mapPermissionToCode(i.permission),IsList:i.view,IsAdd:i.add,IsEdit:i.edit,IsDelete:i.delete,IsExport:!1}))}mapPermissionToCode(t){return{Dashboard:"PER_DASHBOARD",User:"PER_USER",Role:"PER_ROLE","Weight Check":"PER_WEIGHTCHECK","Attribute Check":"PER_ATTRIBUTECHECK","PreCheck List":"PER_PRECHEKLIST","Liquid Preparation":"PER_LIQUIDPREPARATION","Trailer Inspection":"PER_TRAILERINSPECTION","PostCheck List":"PER_POSTCHEKLIST","DownTime Tracking":"PER_DOWNTIMECHECKING","Pallet Packing":"PER_PALLETPACKING","Production Order":"PER_PURCHASEORDER","Trailer Loading":"PER_TRAILERLOADING"}[t]||"UNKNOWN_CODE"}save(){this.isFormSubmitted=!0,this.frmRole.invalid?this.notificationService.error("Please fill all required fields."):this.isEditMode?this.updateRole():this.createRole()}cancel(){this.router.navigate(this.isEditMode?["../..","list"]:["..","list"],{relativeTo:this.activatedRoute})}ngOnDestroy(){this.routerSub&&this.routerSub.unsubscribe()}static#e=this.\u0275fac=function(i){return new(i||s)(e.rXU(d.nX),e.rXU(d.Ix),e.rXU(l.ze),e.rXU(f.W),e.rXU(b.tw),e.rXU(I.n))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["ng-component"]],decls:49,vars:4,consts:[["form","ngForm"],[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center","mb-4"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end"],[1,"mb-0"],[1,"icon-edit"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end"],["mat-flat-button","","class","app-button back-Green",3,"click",4,"ngIf"],["novalidate","",1,"app-form",3,"ngSubmit","formGroup"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-12","col-sm-6","col-md-4","mb-3"],["appearance","fill",1,"full-width"],["matInput","","formControlName","name"],[4,"ngIf"],[1,"table-responsive"],[1,"table","table-hover","table-bordered"],[1,"bg-primary","text-white","text-center"],[4,"ngFor","ngForOf"],[1,"col-lg-12","text-center"],["type","submit","mat-flat-button","",1,"app-button","mr-1","back-Green"],["mat-flat-button","",1,"app-button","back-Green",3,"click"],[3,"formControl"]],template:function(i,o){if(1&i){const r=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h4",6),e.nrm(6,"i",7),e.EFF(7," Add/Edit Role"),e.k0s()(),e.j41(8,"div",8),e.DNE(9,T,2,0,"a",9),e.k0s()(),e.j41(10,"form",10,0),e.bIt("ngSubmit",function(){return e.eBV(r),e.Njj(o.save())}),e.j41(12,"div",11)(13,"div",12)(14,"h5",6),e.EFF(15,"Role Details"),e.k0s()(),e.j41(16,"div",13)(17,"div",14)(18,"div",15)(19,"mat-form-field",16)(20,"mat-label"),e.EFF(21,"Role Name"),e.k0s(),e.nrm(22,"input",17),e.DNE(23,M,2,0,"mat-error",18),e.k0s()()()()(),e.j41(24,"div",11)(25,"div",12)(26,"h5",6),e.EFF(27,"Permissions"),e.k0s()(),e.j41(28,"div",13)(29,"div",19)(30,"table",20)(31,"thead",21)(32,"tr")(33,"th"),e.EFF(34,"Permission"),e.k0s(),e.j41(35,"th"),e.EFF(36,"View"),e.k0s(),e.j41(37,"th"),e.EFF(38,"Add"),e.k0s(),e.j41(39,"th"),e.EFF(40,"Edit"),e.k0s(),e.j41(41,"th"),e.EFF(42,"Delete"),e.k0s()()(),e.j41(43,"tbody"),e.DNE(44,x,11,5,"tr",22),e.k0s()()()()(),e.j41(45,"div",14)(46,"div",23)(47,"button",24),e.EFF(48,"Save"),e.k0s()()()()()()()}2&i&&(e.R7$(9),e.Y8G("ngIf",o.IsViewPermission),e.R7$(),e.Y8G("formGroup",o.frmRole),e.R7$(13),e.Y8G("ngIf",o.frmRole.get("name").invalid&&(o.frmRole.get("name").touched||o.isFormSubmitted)),e.R7$(21),e.Y8G("ngForOf",o.frmRole.get("Permissions").controls))},dependencies:[u.Sq,u.bT,l.qT,l.me,l.BC,l.cb,l.l_,l.j4,l.JD,E.It,E.$z,w.So,C.rl,C.nJ,C.TL,S.fg,y.T],styles:[".permissions-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.permissions-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .permissions-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle;padding:8px}.permissions-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-weight:700}.permissions-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#f9f9f9}.permissions-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin:auto}.permissions-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.permissions-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.card[_ngcontent-%COMP%]{margin-bottom:1.5rem;box-shadow:0 1px 3px #0000001a}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef;padding:.75rem 1.25rem}.card-body[_ngcontent-%COMP%]{padding:1.25rem}.mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.full-width[_ngcontent-%COMP%]{width:100%}.mb-3[_ngcontent-%COMP%]{margin-bottom:1rem}.card-header[_ngcontent-%COMP%]{background-color:#17bb58!important;border-bottom:1px solid rgb(23,187,88)!important;padding:.75rem 1.25rem;color:#fff}.back-Green[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}"]})}return s})();var F=n(9213),P=n(3380);const L=()=>({emptyMessage:"No Data to Display",totalMessage:"Total"}),A=()=>["../","add"],j=s=>["..","edit",s];function G(s,h){1&s&&(e.j41(0,"a",13)(1,"span"),e.EFF(2,"Add New"),e.k0s(),e.nrm(3,"i",14),e.k0s()),2&s&&e.Y8G("routerLink",e.lJ4(1,A))}function N(s,h){if(1&s&&(e.j41(0,"a",19)(1,"mat-icon"),e.EFF(2,"edit"),e.k0s()()),2&s){const t=e.XpG().row;e.Y8G("routerLink",e.eq3(1,j,t.id))}}function U(s,h){if(1&s){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const o=e.XpG().row,r=e.XpG(2);return e.Njj(r.removeRole(o.id))}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}}function H(s,h){if(1&s&&e.DNE(0,N,3,3,"a",17)(1,U,3,0,"button",18),2&s){const t=e.XpG(2);e.Y8G("ngIf",t.IsEditPermission),e.R7$(),e.Y8G("ngIf",t.IsDeletePermission)}}function B(s,h){1&s&&(e.j41(0,"ngx-datatable-column",15),e.DNE(1,H,2,2,"ng-template",16),e.k0s()),2&s&&e.Y8G("sortable",!1)}let D=(()=>{class s{constructor(t,i,o){this.roleService=t,this.notificationService=i,this.permissionService=o,this.roleData=[],this.page=c.Wt.role,this.permissions=c.eZ,this.searchData={isActive:!1},this.IsAddPemission=!1,this.IsEditPermission=!1,this.IsDeletePermission=!1}ngOnInit(){this.IsAddPemission=this.permissionService.hasPermission("Role (PER_ROLE) - Add"),this.IsEditPermission=this.permissionService.hasPermission("Role (PER_ROLE) - Edit"),this.IsDeletePermission=this.permissionService.hasPermission("Role (PER_ROLE) - Delete"),this.getRoleData()}getRoleData(){this.loading=!0,this.roleService.getRole().subscribe(t=>{this.roleData=t,this.loading=!1},t=>{console.log(t),this.loading=!1})}removeRole(t){confirm("Are you sure, you want to delete this role?")&&this.roleService.deleteRole(t).subscribe(()=>{this.getRoleData()},()=>{this.notificationService.error("Something went wrong.")})}removeRolePermission(t){confirm("Are you sure, you want to delete this Weight Check?")&&this.roleService.deleteRole(t).subscribe(()=>{this.getRoleData()},()=>{this.notificationService.error("Something went wrong.")})}updateSearch(t){this.searchData=Object.assign({},t)}isActiveRow(t){return{"text-dark":!t.isActive}}static#e=this.\u0275fac=function(i){return new(i||s)(e.rXU(f.W),e.rXU(b.tw),e.rXU(I.n))};static#t=this.\u0275cmp=e.VBU({type:s,selectors:[["ng-component"]],decls:14,vars:13,consts:[[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end","leftSideHeader"],[1,"mb20","float-left"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end","rightSideHeader","mb10"],["mat-flat-button","","class","app-button btn",3,"routerLink",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"material",3,"rows","columnMode","headerHeight","footerHeight","rowHeight","limit","loadingIndicator","scrollbarH","rowClass","messages"],["name","Role","prop","name"],["name","Actions",3,"sortable",4,"ngIf"],["mat-flat-button","",1,"app-button","btn",3,"routerLink"],[1,"icon-plus"],["name","Actions",3,"sortable"],["ngx-datatable-cell-template",""],["class","icon-green",3,"routerLink",4,"ngIf"],["type","button","style","border: none; background-color: white; color: red;",3,"click",4,"ngIf"],[1,"icon-green",3,"routerLink"],["type","button",2,"border","none","background-color","white","color","red",3,"click"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e.EFF(6,"Role List"),e.k0s()(),e.j41(7,"div",6),e.DNE(8,G,4,2,"a",7),e.k0s()(),e.j41(9,"div",8)(10,"div",9)(11,"ngx-datatable",10),e.nrm(12,"ngx-datatable-column",11),e.DNE(13,B,2,1,"ngx-datatable-column",12),e.k0s()()()()()()),2&i&&(e.R7$(8),e.Y8G("ngIf",o.IsAddPemission),e.R7$(3),e.Y8G("rows",o.roleData)("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight","auto")("limit",10)("loadingIndicator",o.loading)("scrollbarH",!0)("rowClass",o.isActiveRow)("messages",e.lJ4(12,L)),e.R7$(2),e.Y8G("ngIf",o.IsEditPermission||o.IsDeletePermission))},dependencies:[u.bT,E.It,F.An,d.Wk,P.ge,P.ed,P.QI],styles:[".ngx-datatable .datatable-header-cell{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}.btn[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}  .ngx-datatable.material .datatable-body .progress-linear .container{background-color:#90ee90}  .ngx-datatable.material .datatable-body .progress-linear .container .bar{background-color:green}"]})}return s})();n(9239);var k=n(6441);const Y=[{path:"",component:m,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:D,canActivate:[k.L],data:{permission:"Role (PER_ROLE) - View"}},{path:"add",canActivate:[k.L],data:{permission:"Role (PER_ROLE) - Add"},component:_},{path:"edit/:id",canActivate:[k.L],data:{permission:"Role (PER_ROLE) - Edit"},component:_}]}];let K=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({imports:[d.iI.forChild(Y),d.iI]})}return s})();var W=n(9830);let X=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275mod=e.$C({type:s});static#i=this.\u0275inj=e.G2t({providers:[f.W,(0,W._c)()],imports:[p.Gg,K,u.MD,P.Kj]})}return s})()}}]);