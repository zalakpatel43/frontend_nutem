"use strict";(self.webpackChunkskyward_nutem=self.webpackChunkskyward_nutem||[]).push([[807],{6807:(wt,S,d)=>{d.r(S),d.d(S,{DowntimeTrackingModule:()=>Dt});var k=d(177),p=d(8498),t=d(4438);let C=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-downtime"]],decls:1,vars:0,template:function(n,o){1&n&&t.nrm(0,"router-outlet")},dependencies:[p.n3]})}return i})();var m=d(4434),N=d(1626);let b=(()=>{class i{constructor(e,n){this.http=e,this._baseService=n}getDowntimeTrackingList(){return this.http.get(`${m.T6.downtimeTrackingList}`)}getShiftList(){return this.http.get(`${m.T6.ShiftList}`)}getCauseList(){return this.http.get(`${m.T6.CauseList}`)}getMaster(){return this.http.get(`${m.T6.MasterList}`)}getUserList(){return this.http.get(`${m.T6.UserList}`)}getProductionOrderList(){return this.http.get(`${m.T6.ProductionOrderList}`)}getProductList(){return this.http.get(`${m.T6.ProductList}`)}addDowntimeTracking(e){return this.http.post(`${m.T6.downtimeTrackingAdd}`,e)}updateDowntimeTracking(e){return this.http.post(`${m.T6.downtimeTrackingEdit}`,e)}getByIdDowntimeTracking(e){return this.http.get(`${m.T6.downtimeTrackingGetById}?id=`+e)}deleteDowntimeTracking(e){return this.http.delete(`${m.T6.downtimeTrackingDelete}?id=`+e)}static#t=this.\u0275fac=function(n){return new(n||i)(t.KVO(N.Qq),t.KVO(m.dD))};static#e=this.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var P=d(5794),y=d(4532),T=d(8834),j=d(9213),v=d(3380),R=d(6081);const G=()=>({emptyMessage:"No Data to Display",totalMessage:"Total"}),$=()=>["../","add"],O=i=>["..","edit",i];function x(i,s){1&i&&(t.j41(0,"a",16)(1,"span"),t.EFF(2,"Add New"),t.k0s(),t.nrm(3,"i",17),t.k0s()),2&i&&t.Y8G("routerLink",t.lJ4(1,$))}function B(i,s){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&i){const e=s.value;t.R7$(),t.JRh(t.i5U(2,1,e,"MM/dd/yyyy hh:mm a"))}}function Y(i,s){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=s.value;t.R7$(),t.JRh(e)}}function U(i,s){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=s.value;t.R7$(),t.JRh(e)}}function V(i,s){if(1&i&&(t.j41(0,"a",21)(1,"mat-icon"),t.EFF(2,"edit"),t.k0s()()),2&i){const e=t.XpG().row;t.Y8G("routerLink",t.eq3(1,O,e.id))}}function H(i,s){if(1&i){const e=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){t.eBV(e);const o=t.XpG().row,r=t.XpG(2);return t.Njj(r.removeDowntimeTracking(o.id))}),t.j41(1,"mat-icon"),t.EFF(2,"close"),t.k0s()()}}function X(i,s){if(1&i&&t.DNE(0,V,3,3,"a",19)(1,H,3,0,"button",20),2&i){const e=t.XpG(2);t.Y8G("ngIf",e.IsEditPermission),t.R7$(),t.Y8G("ngIf",e.IsDeletePermission)}}function W(i,s){1&i&&(t.j41(0,"ngx-datatable-column",18),t.DNE(1,X,2,2,"ng-template",12),t.k0s()),2&i&&t.Y8G("sortable",!1)}let L=(()=>{class i{constructor(e,n,o){this.downtimeTrackingService=e,this.notificationService=n,this.permissionService=o,this.downtimeTrackingData=[],this.page=m.Wt.downtimeTracking,this.permissions=m.eZ,this.searchData={},this.IsAddPemission=!1,this.IsEditPermission=!1,this.IsDeletePermission=!1}ngOnInit(){this.IsAddPemission=this.permissionService.hasPermission("DownTime Tracking (PER_DOWNTIMECHECKING) - Add"),this.IsEditPermission=this.permissionService.hasPermission("DownTime Tracking (PER_DOWNTIMECHECKING) - Edit"),this.IsDeletePermission=this.permissionService.hasPermission("DownTime Tracking (PER_DOWNTIMECHECKING) - Delete"),this.getDowntimeTrackingData()}getDowntimeTrackingData(){this.loading=!0,this.downtimeTrackingService.getDowntimeTrackingList().subscribe(e=>{this.downtimeTrackingData=e,console.log("Downtime tracking list",this.downtimeTrackingData),this.loading=!1},e=>{this.error=e,this.loading=!1})}removeDowntimeTracking(e){confirm("Are you sure, you want to delete this Downtime Tracking?")&&this.downtimeTrackingService.deleteDowntimeTracking(e).subscribe(()=>{this.getDowntimeTrackingData()},()=>{this.notificationService.error("Something went wrong.")})}updateSearch(e){this.searchData=Object.assign({},e),console.log("Search data",this.searchData)}isActiveRow(e){return{"text-danger":!e.isActive}}static#t=this.\u0275fac=function(n){return new(n||i)(t.rXU(b),t.rXU(P.tw),t.rXU(y.n))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-list"]],decls:20,vars:15,consts:[[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end","leftSideHeader"],[1,"mb20","float-left"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end","rightSideHeader","mb10"],["mat-flat-button","","class","app-button back-Green",3,"routerLink",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"material",3,"rows","columnMode","headerHeight","footerHeight","rowHeight","limit","loadingIndicator","scrollbarH","messages"],["name","Date","prop","productionDateTime"],["ngx-datatable-cell-template",""],["name","Product Name","prop","productName"],["name","Filling Line","prop","productLineName"],["name","Actions",3,"sortable",4,"ngIf"],["mat-flat-button","",1,"app-button","back-Green",3,"routerLink"],[1,"icon-plus"],["name","Actions",3,"sortable"],["class","button-padding icon-green",3,"routerLink",4,"ngIf"],["type","button","style","border: none; background-color: white; color: red;",3,"click",4,"ngIf"],[1,"button-padding","icon-green",3,"routerLink"],["type","button",2,"border","none","background-color","white","color","red",3,"click"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),t.EFF(6,"Downtime Tracking List"),t.k0s()(),t.j41(7,"div",6),t.DNE(8,x,4,2,"a",7),t.k0s()(),t.j41(9,"div",8)(10,"div",9)(11,"ngx-datatable",10),t.nI1(12,"searchtable"),t.j41(13,"ngx-datatable-column",11),t.DNE(14,B,3,4,"ng-template",12),t.k0s(),t.j41(15,"ngx-datatable-column",13),t.DNE(16,Y,2,1,"ng-template",12),t.k0s(),t.j41(17,"ngx-datatable-column",14),t.DNE(18,U,2,1,"ng-template",12),t.k0s(),t.DNE(19,W,2,1,"ngx-datatable-column",15),t.k0s()()()()()()),2&n&&(t.R7$(8),t.Y8G("ngIf",o.IsAddPemission),t.R7$(3),t.Y8G("rows",t.i5U(12,11,o.downtimeTrackingData,o.searchData))("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight","auto")("limit",10)("loadingIndicator",o.loading)("scrollbarH",!0)("messages",t.lJ4(14,G)),t.R7$(8),t.Y8G("ngIf",o.IsEditPermission||o.IsDeletePermission))},dependencies:[k.bT,p.Wk,T.It,j.An,v.ge,v.ed,v.QI,k.vh,R.j],styles:[".ngx-datatable .datatable-header-cell{background-color:#17bb58!important;color:#fff!important}.back-Green[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}  .ngx-datatable.material .datatable-body .progress-linear .container{background-color:#90ee90}  .ngx-datatable.material .datatable-body .progress-linear .container .bar{background-color:green}"]})}return i})();var u=d(9417),f=d(2102),M=d(9631),J=d(2798),A=d(6600),K=d(8777),Q=d(7133),F=d(2356),D=d(8910);function Z(i,s){if(1&i){const e=t.RV6();t.j41(0,"a",45),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.cancel())}),t.EFF(1," View List "),t.k0s()}}function z(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.productName," ")}}function q(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function tt(i,s){1&i&&(t.j41(0,"mat-error"),t.EFF(1," Filling Line is required "),t.k0s())}function et(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.poNumber," ")}}function it(i,s){1&i&&(t.j41(0,"mat-error"),t.EFF(1," Production Order is required "),t.k0s())}function nt(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.causeName," ")}}function ot(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.shiftName," ")}}function at(i,s){if(1&i&&(t.j41(0,"mat-option",46),t.EFF(1),t.k0s()),2&i){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function rt(i,s){if(1&i){const e=t.RV6();t.j41(0,"div",47)(1,"div",17)(2,"div",18)(3,"mat-form-field",23)(4,"mat-label"),t.EFF(5,"Start Time"),t.k0s(),t.nrm(6,"input",48)(7,"ngx-material-timepicker",null,2),t.k0s()(),t.j41(9,"div",18)(10,"mat-form-field",23)(11,"mat-label"),t.EFF(12,"End Time"),t.k0s(),t.j41(13,"input",49),t.bIt("ngModelChange",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.calculateDuration())}),t.k0s(),t.nrm(14,"ngx-material-timepicker",null,3),t.k0s()(),t.j41(16,"div",18)(17,"mat-form-field",23)(18,"mat-label"),t.EFF(19,"Durations"),t.k0s(),t.nrm(20,"input",50),t.k0s()(),t.j41(21,"div",18)(22,"mat-form-field",23)(23,"mat-label"),t.EFF(24,"Cause"),t.k0s(),t.j41(25,"mat-select",51),t.DNE(26,nt,2,2,"mat-option",25),t.k0s()()(),t.j41(27,"div",18)(28,"mat-form-field",23)(29,"mat-label"),t.EFF(30,"Shift"),t.k0s(),t.j41(31,"mat-select",52),t.DNE(32,ot,2,2,"mat-option",25),t.k0s()()(),t.j41(33,"div",18)(34,"mat-form-field",23)(35,"mat-label"),t.EFF(36,"Action Taken"),t.k0s(),t.nrm(37,"input",53),t.k0s()(),t.j41(38,"div",18)(39,"mat-form-field",23)(40,"mat-label"),t.EFF(41,"Action taken By "),t.k0s(),t.j41(42,"mat-select",54),t.DNE(43,at,2,2,"mat-option",25),t.k0s()()(),t.j41(44,"div",55)(45,"button",56),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.addFinalDowntimeDetail())}),t.j41(46,"mat-icon",57),t.EFF(47,"add"),t.k0s()()()()()}if(2&i){const e=s.index,n=t.sdS(8),o=t.sdS(15),r=t.XpG();t.Y8G("formGroupName",e),t.R7$(6),t.Y8G("ngxTimepicker",n),t.R7$(7),t.Y8G("ngxTimepicker",o),t.R7$(13),t.Y8G("ngForOf",r.causeList),t.R7$(6),t.Y8G("ngForOf",r.shiftList),t.R7$(11),t.Y8G("ngForOf",r.usersList)}}function st(i,s){1&i&&t.eu8(0)}function dt(i,s){if(1&i&&(t.qex(0),t.EFF(1),t.DNE(2,st,1,0,"ng-container",28),t.bVm()),2&i){const e=s.$implicit,n=t.XpG(2);t.R7$(),t.SpI(" ",n.userMap.get(e)||"Unknown"," "),t.R7$(),t.Y8G("ngIf",!n.last)}}function ct(i,s){if(1&i){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.DNE(14,dt,3,2,"ng-container",41),t.k0s(),t.j41(15,"td",58)(16,"button",59),t.bIt("click",function(){const o=t.eBV(e),r=o.$implicit,c=o.index,a=t.XpG();return t.Njj(a.onEditDetail(r,c))}),t.nrm(17,"i",60),t.k0s()()()}if(2&i){const e=s.$implicit,n=t.XpG();t.R7$(2),t.JRh(e.StartDate),t.R7$(2),t.JRh(e.EndDate),t.R7$(2),t.JRh(e.Durations),t.R7$(2),t.JRh(n.shiftMap.get(e.ShiftId)||"Unknown"),t.R7$(2),t.JRh(n.causeMap.get(e.CauseId)||"Unknown"),t.R7$(2),t.JRh(e.ActionTaken),t.R7$(2),t.Y8G("ngForOf",e.DoneByUserIds)}}let I=(()=>{class i{constructor(e,n,o,r,c,a){this.activatedRoute=e,this.router=n,this.formBuilder=o,this.downtimeTrackingService=r,this.notificationService=c,this.permissionService=a,this.page=m.Wt.downtimeTracking,this.permissions=m.eZ,this.productionOrderList=[],this.productList=[],this.causeList=[],this.addedDowntimeTrackingDetailsList=[],this.editDetailsId=-1,this.fillingLineList=[],this.shiftList=[],this.usersList=[],this.selectedDate=null,this.selectedTime=null,this.IsViewPermission=!1,this.shiftMap=new Map,this.causeMap=new Map,this.userMap=new Map}ngOnInit(){this.getRoute(),this.loadDropdowns(),this.IsViewPermission=this.permissionService.hasPermission("Weight Check (PER_WEIGHTCHECK) - View"),this.form=this.fb.group({ProductionDateTime:["",u.k0.required],ProductionTime:["",u.k0.required]})}get ProductionDateTime(){return this.downtimeTrackingForm.controls.ProductionDateTime}onDateChange(e){const n=e.value,o=this.downtimeTrackingForm.get("ProductionTime")?.value;n&&o&&this.downtimeTrackingForm.get("ProductionDateTime")?.setValue(`${n}T${o}`)}getRoute(){this.routerSub=this.activatedRoute.params.subscribe(e=>{this.isEditMode=!m.ov.isEmpty(e.id),this.createForm(),this.addDowntimeDetail(),this.isEditMode&&(this.downtimeTrackingId=e.id,this.getDowntimeTrackingById())})}getDowntimeTrackingById(){this.downtimeTrackingService.getByIdDowntimeTracking(this.downtimeTrackingId).subscribe(e=>{this.downtimeTrackingData=e,this.setDowntimeTrackingData()},e=>{console.log(e)})}get isDateTimeValid(){return!(!this.selectedDate||!this.selectedTime)}setDowntimeTrackingData(){this.downtimeTrackingForm.patchValue({Code:this.downtimeTrackingData.code,ProductionDateTime:this.downtimeTrackingData.productionDateTime,ProductId:this.downtimeTrackingData.productId,ProductionOrderId:this.downtimeTrackingData.ProductionOrderId,FillingLineId:this.downtimeTrackingData.FillingLineId,SAPProductionOrderId:this.downtimeTrackingData.sapProductionOrderId,productLineId:this.downtimeTrackingData.productLineId}),this.downtimeTrackingForm.get("ProductionOrderId").disable(),this.downtimeTrackingForm.get("SAPProductionOrderId").disable(),this.downtimeTrackingForm.get("productLineId").disable();const n=o=>{const r=new Date(o);let c=r.getHours();const a=r.getMinutes(),l=c>=12?"PM":"AM";return c%=12,c=c||12,`${c}:${a<10?"0"+a:a} ${l}`};setTimeout(()=>{this.downtimeTrackingData.downtimeTrackingDetails?.forEach(o=>{const r=(o.doneByUserIds||"").split(",").map(a=>Number(a.trim())).filter(a=>!isNaN(a));let c={id:o.id,StartDate:n(o.startDate),EndDate:n(o.endDate),Durations:o.durations,CauseId:o.causeId,ShiftId:o.shiftId,ActionTaken:o.actionTaken,DoneByUserIds:r,IsActive:o.isActive};this.addedDowntimeTrackingDetailsList.push(c)})},500)}loadDropdowns(){this.downtimeTrackingService.getProductionOrderList().subscribe(e=>{this.productionOrderList=e,console.log("Data",this,this.productionOrderList)}),this.downtimeTrackingService.getProductList().subscribe(e=>{this.productList=e}),this.downtimeTrackingService.getCauseList().subscribe(e=>{this.causeList=e,this.causeMap=new Map(e.map(n=>[n.id,n.causeName]))}),this.downtimeTrackingService.getMaster().subscribe(e=>{this.fillingLineList=this.filterFillingLines(e)}),this.downtimeTrackingService.getUserList().subscribe(e=>{this.usersList=e,this.userMap=new Map(e.map(n=>[n.id,n.name]))}),this.downtimeTrackingService.getShiftList().subscribe(e=>{this.shiftList=e,this.shiftMap=new Map(e.map(n=>[n.id,n.shiftName]))})}filterFillingLines(e){return e.filter(n=>n.categoryName&&-1!==n.categoryName.toLowerCase().indexOf("fill"))}createForm(){this.downtimeTrackingForm=this.formBuilder.group({Code:[{value:"",disabled:!0},u.k0.required],ProductionDateTime:["",u.k0.required],ProductId:["",u.k0.required],FillingLineId:[""],DoneByUserIds:[""],SAPProductionOrderId:[""],ProductionOrderId:[""],productLineId:[""],downtimeTrackingDetails:this.formBuilder.array([])})}addDowntimeDetail(){this.downtimeTrackingDetails?.clear(),this.editDetailsId=-1;const e=this.formBuilder.group({StartDate:[""],EndDate:[""],Durations:[""],CauseId:[""],ActionTaken:[""],DoneByUserIds:[""],ShiftId:[""]});this.downtimeTrackingDetails=this.downtimeTrackingForm?.get("downtimeTrackingDetails"),this.downtimeTrackingDetails.push(e)}addFinalDowntimeDetail(){const e=this.downtimeTrackingDetails.at(0).value;e.StartDate&&e.EndDate?(this.editDetailsId>=0?(this.addedDowntimeTrackingDetailsList[this.editDetailsId]={...e,IsActive:!0,id:this.addedDowntimeTrackingDetailsList[this.editDetailsId].id},this.editDetailsId=-1):this.addedDowntimeTrackingDetailsList.push({...e,IsActive:!0,id:0}),this.downtimeTrackingDetails.clear(),this.addDowntimeDetail()):this.notificationService.error("Start Date and End Date are required")}onEditDetail(e,n){this.populateFormWithValues([e]),this.editDetailsId=n}populateFormWithValues(e){const n=Array.isArray(e)?e:[e];this.downtimeTrackingDetails=this.downtimeTrackingForm.get("downtimeTrackingDetails"),this.downtimeTrackingDetails.clear(),n.forEach(o=>{const r=this.formBuilder.group({StartDate:[o.StartDate||""],EndDate:[o.EndDate||""],Durations:[o.Durations||""],CauseId:[o.CauseId||""],ShiftId:[o.ShiftId||""],ActionTaken:[o.ActionTaken||""],DoneByUserIds:[o.DoneByUserIds||[]],IsActive:[o.IsActive||!0]});this.downtimeTrackingDetails.push(r)})}removeDowntimeDetail(e){this.addedDowntimeTrackingDetailsList.splice(e,1)}save(){if(this.isFormSubmitted=!0,this.downtimeTrackingForm.invalid)return void this.notificationService.error("Please fill out all required fields.");if(0===this.addedDowntimeTrackingDetailsList.length)return void this.notificationService.error("At least one downtime detail is required.");const e=this.downtimeTrackingForm.value;e.downtimeTrackingDetails=this.addedDowntimeTrackingDetailsList;const n=this.transformData(e);console.log("Transformed Payload:",n),this.isEditMode?this.updateDowntimeTracking(n):this.createDowntimeTracking(n),this.downtimeTrackingForm.reset(),this.addedDowntimeTrackingDetailsList=[],this.addDowntimeDetail()}transformData(e){function n(a){const l=new Date(a);if(isNaN(l.getTime()))throw new Error("Invalid date string provided");return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}T${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}:00.000Z`}function o(a){const l=new Date,[g,w]=a.split(" ");let[h,_]=g.split(":").map(Number);return"PM"===w&&h<12&&(h+=12),"AM"===w&&12===h&&(h=0),l.setHours(h),l.setMinutes(_),l.setSeconds(0),l.setMilliseconds(0),n(l.toISOString())}console.log("Original Data:",e);const r=Array.isArray(e.downtimeTrackingDetails)?e.downtimeTrackingDetails:[];return{id:this.isEditMode?this.downtimeTrackingData.id:0,code:this.isEditMode?this.downtimeTrackingData.code:"",productionDateTime:n(e.ProductionDateTime),productId:this.isEditMode?this.downtimeTrackingData.productId:e.ProductId,productName:this.isEditMode?this.downtimeTrackingData.productName:"string",productLineId:this.isEditMode?this.downtimeTrackingData.productLineId:e.productLineId,productLineName:this.isEditMode?this.downtimeTrackingData.productLineName:"string",isActive:!0,SAPProductionOrderId:this.isEditMode?this.downtimeTrackingData.sapProductionOrderId:e.SAPProductionOrderId,downtimeTrackingDetails:r.map(a=>({id:a.id||0,headerId:this.isEditMode?this.downtimeTrackingData.id:0,startDate:o(a.StartDate),endDate:o(a.EndDate),durations:a.Durations,causeId:a.CauseId,shiftId:a.ShiftId,actionTaken:a.ActionTaken,doneByUserIds:(Array.isArray(a.DoneByUserIds)?a.DoneByUserIds.join(","):a.DoneByUserIds)||"",doneByUserNames:"",isActive:a.IsActive||!0}))}}createDowntimeTracking(e){console.log("Creating Downtime Tracking:",e),this.downtimeTrackingService.addDowntimeTracking(e).subscribe(n=>{console.log("Create Response:",n),this.cancel(),this.notificationService.success("Downtime Tracking created successfully.")},n=>{console.error("Error creating Downtime Tracking:",n),this.error=n,this.notificationService.error("Failed to create Downtime Tracking.")})}updateDowntimeTracking(e){console.log("Updating Downtime Tracking:",e),this.downtimeTrackingService.updateDowntimeTracking(e).subscribe(n=>{console.log("Update Response:",n),this.cancel(),this.notificationService.success("Downtime Tracking updated successfully.")},n=>{console.error("Error updating Downtime Tracking:",n),this.error=n,this.notificationService.error("Failed to update Downtime Tracking.")})}ngOnDestroy(){this.routerSub&&this.routerSub.unsubscribe()}cancel(){this.router.navigate(this.isEditMode?["../..","list"]:["..","list"],{relativeTo:this.activatedRoute})}calculateDuration(){const e=this.downtimeTrackingDetails.at(0).get("StartDate")?.value,n=this.downtimeTrackingDetails.at(0).get("EndDate")?.value;if(e&&n){const o=this.parseTime(e),r=this.parseTime(n),c=Math.round((r.getTime()-o.getTime())/6e4),g=`${Math.floor(c/60)}hr ${c%60}min`;this.downtimeTrackingDetails.at(0).get("Durations")?.setValue(g)}}parseTime(e){const[n,o]=e.split(" ");let[r,c]=n.split(":").map(Number);"PM"===o&&r<12&&(r+=12),"AM"===o&&12===r&&(r=0);const a=new Date;return a.setHours(r),a.setMinutes(c),a.setSeconds(0),a.setMilliseconds(0),a}static#t=this.\u0275fac=function(n){return new(n||i)(t.rXU(p.nX),t.rXU(p.Ix),t.rXU(u.ok),t.rXU(b),t.rXU(P.tw),t.rXU(y.n))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-down-time"]],decls:92,vars:16,consts:[["form","ngForm"],["pickerProductionDateTime",""],["startDatePicker",""],["endDatePicker",""],[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center","mb-4"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end"],[1,"mb-0"],[1,"icon-edit"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end"],["mat-flat-button","","class","app-button back-Green",3,"click",4,"ngIf"],["novalidate","",1,"app-form",3,"submit","formGroup"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-12","col-sm-6","col-md-4","col-lg-3","mb-3"],["appearance","fill"],["matInput","","placeholder","Production Date Time","formControlName","ProductionDateTime","required","",3,"ngxMatDatetimePicker"],["type","button","mat-icon-button","","matSuffix","",3,"click"],["apperance","fill"],["appearance","fill",1,"full-width"],["formControlName","ProductId",3,"disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"control","message","formSubmitted"],["formControlName","productLineId",3,"disabled"],[4,"ngIf"],["formControlName","SAPProductionOrderId",3,"disabled"],[1,"card-header","d-flex","align-items-center","justify-content-between"],["formArrayName","downtimeTrackingDetails"],["class","row mt-3",3,"formGroupName",4,"ngFor","ngForOf"],[1,"col-md-12"],[1,"table-responsive"],["id","gridDowntimeTracking",1,"table","table-hover","table-bordered","display","mb-30","fixed-table-scroll-inner",2,"overflow","scroll","width","auto"],[1,"bg-primary","text-primary","text-center"],[1,"back-Green",2,"width","10%"],[1,"back-Green",2,"width","15%"],[1,"back-Green",2,"width","20%"],[1,"back-Green",2,"width","5%"],[4,"ngFor","ngForOf"],[1,"col-lg-12","text-center"],["type","submit","mat-flat-button","",1,"app-button","mr-1","back-Green"],[1,"static-data"],["mat-flat-button","",1,"app-button","back-Green",3,"click"],[3,"value"],[1,"row","mt-3",3,"formGroupName"],["matInput","","placeholder","Select time","formControlName","StartDate",3,"ngxTimepicker"],["matInput","","placeholder","Select time","formControlName","EndDate",3,"ngModelChange","ngxTimepicker"],["matInput","","formControlName","Durations","readonly",""],["formControlName","CauseId"],["formControlName","ShiftId"],["matInput","","formControlName","ActionTaken"],["formControlName","DoneByUserIds","multiple",""],[1,"col-12","col-sm-12","col-md-2","col-lg-2","mb-3","p-1","d-flex","align-items-center"],["type","button","mat-icon-button","",3,"click"],[1,"icon-green"],[1,"text-center"],["type","button",1,"btn","btn-success","btn-sm","btnModifyRow","back-Green",3,"click"],[1,"fa","fa-pencil"]],template:function(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"h4",9),t.nrm(6,"i",10),t.EFF(7," Add/Edit Downtime Tracking"),t.k0s()(),t.j41(8,"div",11),t.DNE(9,Z,2,0,"a",12),t.k0s()(),t.j41(10,"form",13,0),t.bIt("submit",function(){return t.eBV(r),t.Njj(o.save())}),t.j41(12,"div",14)(13,"div",15)(14,"h5",9),t.EFF(15,"Downtime Tracking Header"),t.k0s()(),t.j41(16,"div",16)(17,"div",17)(18,"div",18)(19,"mat-form-field",19),t.nrm(20,"input",20),t.j41(21,"button",21),t.bIt("click",function(){t.eBV(r);const a=t.sdS(25);return t.Njj(a.open())}),t.j41(22,"mat-icon"),t.EFF(23,"calendar_today"),t.k0s()(),t.nrm(24,"ngx-mat-datetime-picker",22,1),t.k0s()(),t.j41(26,"div",18)(27,"mat-form-field",23)(28,"mat-label"),t.EFF(29,"Product"),t.k0s(),t.j41(30,"mat-select",24),t.DNE(31,z,2,2,"mat-option",25),t.k0s(),t.nrm(32,"mat-validation-message",26),t.k0s()(),t.j41(33,"div",18)(34,"mat-form-field",23)(35,"mat-label"),t.EFF(36,"Filling Line"),t.k0s(),t.j41(37,"mat-select",27),t.DNE(38,q,2,2,"mat-option",25),t.k0s(),t.DNE(39,tt,2,0,"mat-error",28),t.k0s()(),t.j41(40,"div",18)(41,"mat-form-field",23)(42,"mat-label"),t.EFF(43,"Production Order"),t.k0s(),t.j41(44,"mat-select",29),t.DNE(45,et,2,2,"mat-option",25),t.k0s(),t.DNE(46,it,2,0,"mat-error",28),t.k0s()()()()(),t.j41(47,"div",14)(48,"div",30)(49,"h5",9),t.EFF(50,"Downtime Tracking Details"),t.k0s()(),t.j41(51,"div",16)(52,"div",31),t.DNE(53,rt,48,6,"div",32),t.k0s()()(),t.j41(54,"div",17)(55,"div",33)(56,"div",34)(57,"table",35)(58,"thead",36)(59,"tr")(60,"th",37),t.EFF(61,"Start Date"),t.k0s(),t.j41(62,"th",37),t.EFF(63,"End Date"),t.k0s(),t.j41(64,"th",38),t.EFF(65,"Durations"),t.k0s(),t.j41(66,"th",38),t.EFF(67,"Shift"),t.k0s(),t.j41(68,"th",38),t.EFF(69,"Cause"),t.k0s(),t.j41(70,"th",39),t.EFF(71,"Action Taken"),t.k0s(),t.j41(72,"th",39),t.EFF(73,"Action Taken By"),t.k0s(),t.j41(74,"th",40),t.EFF(75,"Action"),t.k0s()()(),t.j41(76,"tbody"),t.DNE(77,ct,18,7,"tr",41),t.k0s()()()()(),t.j41(78,"div",17)(79,"div",42)(80,"button",43),t.EFF(81,"Save"),t.k0s()()()(),t.j41(82,"div",44)(83,"h5"),t.EFF(84,"DOWNTIME REPORTING INSTRUCTION"),t.k0s(),t.j41(85,"ul")(86,"li"),t.EFF(87,"1. Downtime (D/T) to be documented whenever the FILLER is NOT running. Operator to record the Duration and Cause as well as the Actions Taken to correct the issue."),t.k0s(),t.j41(88,"li"),t.EFF(89,"2. A Breakdown (B/D) is any single stop which is greater than 10 minutes. All other down time to be registered as accumulated. When a B/D occurs notify the Shift Supervisor/Production Manager and record under Action Taken."),t.k0s(),t.j41(90,"li"),t.EFF(91,"3. If a Quality issue is the cause, notify the Shift Supervisor/Production Manager and QA and record under Action Taken."),t.k0s()()()()()()}if(2&n){const r=t.sdS(25);t.R7$(9),t.Y8G("ngIf",o.IsViewPermission),t.R7$(),t.Y8G("formGroup",o.downtimeTrackingForm),t.R7$(10),t.Y8G("ngxMatDatetimePicker",r),t.R7$(10),t.Y8G("disabled",o.isEditMode),t.R7$(),t.Y8G("ngForOf",o.productList),t.R7$(),t.Y8G("control",o.downtimeTrackingForm.controls.ProductId)("message","Product")("formSubmitted",o.isFormSubmitted),t.R7$(5),t.Y8G("disabled",o.isEditMode),t.R7$(),t.Y8G("ngForOf",o.fillingLineList),t.R7$(),t.Y8G("ngIf",o.downtimeTrackingForm.get("FillingLineId").invalid&&o.isFormSubmitted),t.R7$(5),t.Y8G("disabled",o.isEditMode),t.R7$(),t.Y8G("ngForOf",o.productionOrderList),t.R7$(),t.Y8G("ngIf",o.downtimeTrackingForm.get("ProductionOrderId").invalid&&o.isFormSubmitted),t.R7$(7),t.Y8G("ngForOf",o.downtimeTrackingDetails.controls),t.R7$(24),t.Y8G("ngForOf",o.addedDowntimeTrackingDetailsList)}},dependencies:[k.Sq,k.bT,u.qT,u.me,u.BC,u.cb,u.YS,u.j4,u.JD,u.$R,u.v8,T.It,T.$z,T.iY,f.rl,f.nJ,f.TL,f.yw,M.fg,j.An,J.VO,A.wT,K.T,Q.r,F.zk,F.v2,D.m7,D.yF],styles:[".card[_ngcontent-%COMP%]{margin-bottom:1.5rem;box-shadow:0 1px 3px #0000001a}.card-body[_ngcontent-%COMP%]{padding:1.25rem}.static-data[_ngcontent-%COMP%]{margin-top:20px;padding:15px;border:1px solid #ddd;border-radius:5px;background-color:#f9f9f9}.static-data[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:10px}.static-data[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:decimal;margin-left:20px}.mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.mb-3[_ngcontent-%COMP%]{margin-bottom:1rem}.full-width[_ngcontent-%COMP%]{width:100%}.readonly-input[_ngcontent-%COMP%]{color:#000;background-color:#f5f5f5;cursor:not-allowed;border:1px solid #dcdcdc}  .mat-calendar{margin-top:20px;background-color:#d3d3d3}  .time-container{background-color:#d3d3d3}  .mat-calendar-body-selected{background-color:#1976d2!important;color:#fff!important;border-radius:50%!important}  .mat-calendar-body-active{background-color:#42a5f5!important;border-radius:50%!important}  .mat-calendar-body-today{border-color:#ff9800!important;border-width:2px;border-style:solid;border-radius:50%}.card-header[_ngcontent-%COMP%]{background-color:#17bb58!important;border-bottom:1px solid rgb(23,187,88)!important;padding:.75rem 1.25rem;color:#fff}.back-Green[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}"]})}return i})();d(9239);var E=d(6441);const ut=[{path:"",component:C,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:L,canActivate:[E.L],data:{permission:"DownTime Tracking (PER_DOWNTIMECHECKING) - View"}},{path:"add",canActivate:[E.L],data:{permission:"DownTime Tracking (PER_DOWNTIMECHECKING) - Add"},component:I},{path:"edit/:id",canActivate:[E.L],data:{permission:"DownTime Tracking (PER_DOWNTIMECHECKING) - Edit"},component:I}]}];let gt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.$C({type:i});static#i=this.\u0275inj=t.G2t({imports:[p.iI.forChild(ut),p.iI]})}return i})();var ht=d(1774),pt=d(9830),kt=d(5263),ft=d(40);let Dt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.$C({type:i});static#i=this.\u0275inj=t.G2t({providers:[b,(0,pt._c)()],imports:[k.MD,gt,ht.Gg,F.c9,D.Hw,D.Xg,D.T_,A.WX,kt.ZG,ft.Yr,f.RG,M.fS]})}return i})()}}]);