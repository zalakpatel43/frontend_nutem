"use strict";(self.webpackChunkskyward_nutem=self.webpackChunkskyward_nutem||[]).push([[637],{1637:(ae,k,o)=>{o.r(k),o.d(k,{UserModule:()=>re});var u=o(1774),y=o(9830),h=o(8498),a=o(9417),_=o(775),l=o(4434),e=o(4438);let g=(()=>{class i extends l.QP{constructor(t){super(t,"user"),this._baseService=t}getReportsToUsers(t,r){return this._baseService.get(`${l.T6.account}/gettownusers/${t}/${r}`)}getUsers(t,r){return this._baseService.get(`${l.T6.user}/paged?pageIndex=${t}&pageSize=${r}`)}assignRole(t,r){return this._baseService.post(`${l.T6.user}/${t}/assign-role?role=${r}`,{})}removeRole(t,r){return this._baseService.post(`${l.T6.user}/${t}/remove-role?role=${r}`,{})}getRoles(t){return this._baseService.get(`${l.T6.user}/${t}/roles`)}deleteUser(t){return this._baseService.delete(`${l.T6.UserList}/${t}`)}static#e=this.\u0275fac=function(r){return new(r||i)(e.KVO(l.dD))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();var I=o(2558),R=o(5794),w=o(4532),p=o(177),f=o(8834),v=o(2102),F=o(9631),E=o(9213),P=o(2798),T=o(6600),A=o(8777),N=o(7371),$=o(1331),G=o(7133);function V(i,c){if(1&i){const t=e.RV6();e.j41(0,"a",28),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.cancel())}),e.EFF(1," View List "),e.k0s()}}function M(i,c){1&i&&(e.j41(0,"div"),e.EFF(1," Minimum 10 Characters Required "),e.k0s())}function L(i,c){if(1&i&&(e.j41(0,"div",29),e.DNE(1,M,2,0,"div",30),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.frmUser.controls.phoneNumber.errors.minlength)}}function x(i,c){if(1&i&&(e.j41(0,"mat-option",31),e.EFF(1),e.k0s()),2&i){const t=c.$implicit;e.Y8G("value",t.name),e.R7$(),e.SpI(" ",t.name," ")}}let b=(()=>{class i{constructor(t,r,s,n,d,m,ie,oe){this.activatedRoute=t,this.router=r,this.formBuilder=s,this.userService=n,this.roleService=d,this.notificationService=m,this.listService=ie,this.permissionService=oe,this.reportsToData=[],this.roleData=[],this.hidePassword=!0,this.hideConfirmPassword=!0,this.page=l.Wt.user,this.permissions=l.eZ,this.IsViewPermission=!1,this.createForm()}ngOnInit(){this.getUserRoute(),this.getRoleData(),this.IsViewPermission=this.permissionService.hasPermission("User (PER_USER) - View")}getUserRoute(){this.routerSub=this.activatedRoute.params.subscribe(t=>{this.isEditMode=!l.ov.isEmpty(t.id),this.createForm(),this.isEditMode?(this.userId=t.id,this.getUserDetails()):(this.userData=new _.KJ,this.getRoleData())})}getUserDetails(){this.userService.getById(this.userId).subscribe(t=>{this.userData=t,this.setUserData(),this.getRoleData(),this.getUserRoles()},t=>{console.log(t)})}getUserRoles(){this.userService.getRoles(this.userId).subscribe(t=>{this.frmUser.controls.role.setValue(t[0]||"")},t=>{console.log(t)})}getRoleData(){this.roleService.getRole().subscribe(t=>{this.roleData=t,this.createRolesControl()},t=>{console.log(t)})}getReportsToData(){l.ov.isNotNull(this.userId),this.userService.get().subscribe(r=>{this.reportsToData=r,this.createReportsToControl()})}setUserData(){this.frmUser.patchValue(this.userData),this.frmUser.controls.password.setValue("********"),this.frmUser.controls.confirmPassword.setValue("********")}createForm(){this.frmUser=this.formBuilder.group({userName:[{value:"",disabled:this.isEditMode},[a.k0.required,a.k0.maxLength(50)]],password:[{value:"",disabled:this.isEditMode},[a.k0.required,a.k0.min(6),a.k0.maxLength(20),u.Bm.passwordValidator]],confirmPassword:[{value:"",disabled:this.isEditMode},[a.k0.required,u.Bm.comparePassword]],email:["",[a.k0.required,u.Bm.emailValidator,u.Bm.multipleemailrestrictValidator,a.k0.maxLength(50)]],phoneNumber:["",[a.k0.maxLength(15)]],role:["",[a.k0.required]],name:["",[a.k0.required]]})}createReportsToControl(){const t=this.frmUser.controls.reportsTo;t.controls=[],this.reportsToData.forEach(r=>{t.push(new a.hs((this.userData.reportsTo||[]).some(s=>s.reportToId===r.id)))})}createRolesControl(){}createUser(){let t=Object.assign({},this.frmUser.value);this.userService.add(t).subscribe(r=>{if(r){this.userId=r.id;const s=this.frmUser.get("role").value;s&&this.assignRoleToUser(this.userId,s),this.notificationService.success("User saved successfully."),this.cancel()}else this.notificationService.warning(r.message)},r=>{400===r.status?Array.isArray(r.error)&&r.error.length>0&&this.notificationService.error(r.error[0].description):this.error="Something went wrong"})}updateUser(){this.userData=Object.assign(this.userData,this.frmUser.value),this.userService.update(this.userData.id,this.userData).subscribe(r=>{this.cancel(),r?this.notificationService.warning(r?.message||"An unexpected error occurred."):(this.notificationService.success("User updated successfully."),this.router.navigate(["../..","list"],{relativeTo:this.activatedRoute}),this.cancel())},r=>{console.error("Update Error:",r);const s=r?.error?.modelState?.[""]?.[0]||"Something went wrong";this.error=s,this.notificationService.error(s)})}save(){if(this.isFormSubmitted=!0,this.frmUser.invalid)return;this.isEditMode?this.updateUser():this.createUser();const t=this.frmUser.get("role").value;t&&this.handleRoleAssignment(t)}handleRoleAssignment(t){this.isEditMode?this.userService.getRoles(this.userId).subscribe(r=>{const s=r[0];s&&s!==t?this.userService.removeRole(this.userId,s).subscribe(()=>{this.assignRoleToUser(this.userId,t)},n=>{this.notificationService.error(`Failed to remove old role: ${n.message}`)}):this.assignRoleToUser(this.userId,t)},r=>{this.notificationService.error(`Failed to get current roles: ${r.message}`)}):this.assignRoleToUser(this.userId,t)}assignRoleToUser(t,r){this.userService.assignRole(t,r).subscribe(s=>{this.notificationService.success(`Role '${r}' assigned successfully to user.`)})}setValidators(){l.ov.getSelectedCheckboxList(this.frmUser.value.roles,this.roleData).some(r=>"Super Admin"===r.name)?this.frmUser.controls.parkingAuthorityId.setValidators([]):this.frmUser.controls.parkingAuthorityId.setValidators([a.k0.required]),this.frmUser.controls.parkingAuthorityId.updateValueAndValidity()}keyDownHandler(t){"Space"===t.code&&t.preventDefault()}cancel(){this.router.navigate(this.isEditMode?["../..","list"]:["..","list"],{relativeTo:this.activatedRoute})}ngOnDestroy(){this.routerSub.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||i)(e.rXU(h.nX),e.rXU(h.Ix),e.rXU(a.ze),e.rXU(g),e.rXU(I.W),e.rXU(R.tw),e.rXU(l.aG),e.rXU(w.n))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["ng-component"]],decls:69,vars:31,consts:[["form","ngForm"],[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center"],[1,"col-lg-7","col-sm-9","col-10","d-flex","align-items-end","leftSideHeader"],[1,"mb20","float-left"],[1,"col-lg-5","col-sm-3","col-2","d-flex","justify-content-end","rightSideHeader","mb10"],["mat-flat-button","","class","app-button back-Green",3,"click",4,"ngIf"],["novalidate","",1,"app-form",3,"submit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-md-4","col-lg-3"],[1,"full-width"],["type","text","matInput","","formControlName","name","textlower","",3,"keydown"],[3,"control","message","formSubmitted"],[1,"w-100"],["type","text","matInput","","formControlName","userName","space-restrict","",3,"keydown"],["type","text","matInput","","formControlName","email","textlower","",3,"keydown"],["type","text","mask","(000) 000-0000","matInput","","formControlName","phoneNumber","autocomplete","nope",3,"dropSpecialCharacters"],["class","custom-validation",4,"ngIf"],["matInput","","formControlName","password","autocomplete","off",3,"keydown","type"],["type","button","mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","confirmPassword","autocomplete","off",3,"keydown","type"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-12"],[1,"col-lg-12","text-center"],["type","submit","mat-flat-button","",1,"app-button","mr-1","back-Green"],["mat-flat-button","",1,"app-button","back-Green",3,"click"],[1,"custom-validation"],[4,"ngIf"],[3,"value"]],template:function(r,s){if(1&r){const n=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h4",6),e.EFF(6,"User Details"),e.k0s()(),e.j41(7,"div",7)(8,"div"),e.DNE(9,V,2,0,"a",8),e.k0s()()(),e.j41(10,"div")(11,"form",9,0),e.bIt("submit",function(){return e.eBV(n),e.Njj(s.save())}),e.j41(13,"div",10)(14,"div",11)(15,"mat-form-field",12)(16,"mat-label"),e.EFF(17,"Name"),e.k0s(),e.j41(18,"input",13),e.bIt("keydown",function(m){return e.eBV(n),e.Njj(s.keyDownHandler(m))}),e.k0s(),e.nrm(19,"mat-validation-message",14),e.k0s()(),e.j41(20,"div",11)(21,"mat-form-field",15)(22,"mat-label"),e.EFF(23,"Username"),e.k0s(),e.j41(24,"input",16),e.bIt("keydown",function(m){return e.eBV(n),e.Njj(s.keyDownHandler(m))}),e.k0s(),e.nrm(25,"mat-validation-message",14),e.k0s()(),e.j41(26,"div",11)(27,"mat-form-field",12)(28,"mat-label"),e.EFF(29,"Email"),e.k0s(),e.j41(30,"input",17),e.bIt("keydown",function(m){return e.eBV(n),e.Njj(s.keyDownHandler(m))}),e.k0s(),e.nrm(31,"mat-validation-message",14),e.k0s()(),e.j41(32,"div",11)(33,"mat-form-field",12)(34,"mat-label"),e.EFF(35,"Phone Number"),e.k0s(),e.nrm(36,"input",18),e.DNE(37,L,2,1,"div",19),e.k0s()(),e.j41(38,"div",11)(39,"mat-form-field",12)(40,"mat-label"),e.EFF(41,"Password"),e.k0s(),e.j41(42,"input",20),e.bIt("keydown",function(m){return e.eBV(n),e.Njj(s.keyDownHandler(m))}),e.k0s(),e.j41(43,"button",21),e.bIt("click",function(){return e.eBV(n),e.Njj(s.hidePassword=!s.hidePassword)}),e.j41(44,"mat-icon"),e.EFF(45),e.k0s()(),e.nrm(46,"mat-validation-message",14),e.k0s()(),e.j41(47,"div",11)(48,"mat-form-field",12)(49,"mat-label"),e.EFF(50,"Confirm Password"),e.k0s(),e.j41(51,"input",22),e.bIt("keydown",function(m){return e.eBV(n),e.Njj(s.keyDownHandler(m))}),e.k0s(),e.j41(52,"button",21),e.bIt("click",function(){return e.eBV(n),e.Njj(s.hideConfirmPassword=!s.hideConfirmPassword)}),e.j41(53,"mat-icon"),e.EFF(54),e.k0s()(),e.nrm(55,"mat-validation-message",14),e.k0s()(),e.j41(56,"div",11)(57,"mat-form-field",12)(58,"mat-label"),e.EFF(59,"Role"),e.k0s(),e.j41(60,"mat-select",23),e.DNE(61,x,2,2,"mat-option",24),e.k0s(),e.nrm(62,"mat-validation-message",14),e.k0s()(),e.j41(63,"div",25),e.EFF(64," \xa0 "),e.k0s()(),e.j41(65,"div",10)(66,"div",26)(67,"button",27),e.EFF(68,"Save"),e.k0s()()()()()()()()}2&r&&(e.R7$(9),e.Y8G("ngIf",s.IsViewPermission),e.R7$(2),e.Y8G("formGroup",s.frmUser),e.R7$(8),e.Y8G("control",s.frmUser.controls.name)("message","Name")("formSubmitted",s.isFormSubmitted),e.R7$(6),e.Y8G("control",s.frmUser.controls.userName)("message","Username")("formSubmitted",s.isFormSubmitted),e.R7$(6),e.Y8G("control",s.frmUser.controls.email)("message","Email")("formSubmitted",s.isFormSubmitted),e.R7$(5),e.Y8G("dropSpecialCharacters",!1),e.R7$(),e.Y8G("ngIf",s.frmUser.controls.phoneNumber.errors),e.R7$(5),e.Y8G("type",s.hidePassword||s.isEditMode?"password":"text"),e.R7$(),e.BMQ("aria-label","Hide password")("aria-pressed",s.hidePassword),e.R7$(2),e.JRh(s.hidePassword?"visibility_off":"visibility"),e.R7$(),e.Y8G("control",s.frmUser.controls.password)("message","Password")("formSubmitted",s.isFormSubmitted),e.R7$(5),e.Y8G("type",s.hideConfirmPassword||s.isEditMode?"password":"text"),e.R7$(),e.BMQ("aria-label","Hide confirm password")("aria-pressed",s.hideConfirmPassword),e.R7$(2),e.JRh(s.hideConfirmPassword?"visibility_off":"visibility"),e.R7$(),e.Y8G("control",s.frmUser.controls.confirmPassword)("message","Confirm Password")("formSubmitted",s.isFormSubmitted),e.R7$(6),e.Y8G("ngForOf",s.roleData),e.R7$(),e.Y8G("control",s.frmUser.controls.role)("message","Role")("formSubmitted",s.isFormSubmitted))},dependencies:[p.Sq,p.bT,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,f.It,f.$z,f.iY,v.rl,v.nJ,v.yw,F.fg,E.An,P.VO,T.wT,y.Zr,A.T,N.X,$.U,G.r],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.card-header[_ngcontent-%COMP%]{background-color:#17bb58!important;border-bottom:1px solid rgb(23,187,88)!important;padding:.75rem 1.25rem;color:#fff}.back-Green[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}"]})}return i})();var U=o(3380),C=o(6695),B=o(6081);const Y=()=>({emptyMessage:"No Data to Display",totalMessage:"Total"}),H=()=>["../","add"],X=i=>["../","edit",i];function O(i,c){1&i&&(e.j41(0,"a",18)(1,"span"),e.EFF(2,"Add New"),e.k0s(),e.nrm(3,"i",19),e.k0s()),2&i&&e.Y8G("routerLink",e.lJ4(1,H))}function z(i,c){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=c.value;e.R7$(),e.JRh(e.i5U(2,1,t,"MM/dd/yyyy hh:mm a"))}}function J(i,c){if(1&i&&(e.j41(0,"a",23)(1,"mat-icon"),e.EFF(2,"edit"),e.k0s()()),2&i){const t=e.XpG().row;e.Y8G("routerLink",e.eq3(1,X,t.id))}}function Q(i,c){if(1&i){const t=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(t);const s=e.XpG().row,n=e.XpG(2);return e.Njj(n.toggleActivate(s.id))}),e.j41(1,"mat-icon"),e.EFF(2,"close"),e.k0s()()}}function W(i,c){if(1&i&&e.DNE(0,J,3,3,"a",21)(1,Q,3,0,"button",22),2&i){const t=e.XpG(2);e.Y8G("ngIf",t.IsEditPermission),e.R7$(),e.Y8G("ngIf",t.IsDeletePermission)}}function K(i,c){1&i&&(e.j41(0,"ngx-datatable-column",20),e.DNE(1,W,2,2,"ng-template",15),e.k0s())}let j=(()=>{class i{constructor(t,r,s){this.userService=t,this.notificationService=r,this.permissionService=s,this.userData=[],this.page=l.Wt.user,this.permissions=l.eZ,this.searchData={isActive:!1},this.pageIndex=1,this.pageSize=10,this.totalItems=0,this.IsAddPemission=!1,this.IsEditPermission=!1,this.IsDeletePermission=!1}ngOnInit(){this.IsAddPemission=this.permissionService.hasPermission("User (PER_USER) - Add"),this.IsEditPermission=this.permissionService.hasPermission("User (PER_USER) - Edit"),this.IsDeletePermission=this.permissionService.hasPermission("User (PER_USER) - Delete"),this.getUserData()}getUserData(){this.loading=!0,this.userService.getUsers(this.pageIndex,this.pageSize).subscribe(t=>{this.loading=!1,this.userData=t.items,this.totalItems=t.totalCount},t=>{this.loading=!1,console.log(t)})}onPageChange(t){this.pageIndex=t.pageIndex+1,this.getUserData()}getRoles(t){return t.map(r=>r.roleName).join(", ")}updateSearch(t){this.searchData={...t}}isActiveRow(t){return{"text-danger":!t.isActive}}toggleActivate(t){confirm("Are you sure you want to delete User ?")&&this.userService.deleteUser(t).subscribe(s=>{s?this.getUserData():this.notificationService.warning(s.message)},s=>{this.notificationService.error("Something went wrong.")})}static#e=this.\u0275fac=function(r){return new(r||i)(e.rXU(g),e.rXU(R.tw),e.rXU(w.n))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["ng-component"]],decls:21,vars:19,consts:[[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center"],[1,"col-lg-7","col-sm-9","col-10","d-flex","align-items-end","leftSideHeader"],[1,"mb20","float-left"],[1,"col-lg-5","col-sm-3","col-2","d-flex","justify-content-end","rightSideHeader","mb10"],["mat-flat-button","","class","app-button btn",3,"routerLink",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"material",3,"rows","columnMode","headerHeight","footerHeight","rowHeight","limit","loadingIndicator","scrollbarH","rowClass","messages"],["name","User Name","prop","userName"],["name","Email","prop","email"],["name","Phone Number","prop","phoneNumber"],["name","Registered On","prop","createdDate"],["ngx-datatable-cell-template",""],["name","Actions",4,"ngIf"],[3,"page","pageSize","pageIndex","length"],["mat-flat-button","",1,"app-button","btn",3,"routerLink"],[1,"icon-plus"],["name","Actions"],["title","Edit","class","button-padding icon-green",3,"routerLink",4,"ngIf"],["type","button","style","border: none; background-color: white; color: red;",3,"click",4,"ngIf"],["title","Edit",1,"button-padding","icon-green",3,"routerLink"],["type","button",2,"border","none","background-color","white","color","red",3,"click"]],template:function(r,s){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e.EFF(6,"User List"),e.k0s()(),e.j41(7,"div",6)(8,"div"),e.DNE(9,O,4,2,"a",7),e.k0s()()(),e.j41(10,"div",8)(11,"div",9)(12,"ngx-datatable",10),e.nI1(13,"searchtable"),e.nrm(14,"ngx-datatable-column",11)(15,"ngx-datatable-column",12)(16,"ngx-datatable-column",13),e.j41(17,"ngx-datatable-column",14),e.DNE(18,z,3,4,"ng-template",15),e.k0s(),e.DNE(19,K,2,0,"ngx-datatable-column",16),e.k0s(),e.j41(20,"mat-paginator",17),e.bIt("page",function(d){return s.onPageChange(d)}),e.k0s()()()()()()),2&r&&(e.R7$(9),e.Y8G("ngIf",s.IsAddPemission),e.R7$(3),e.Y8G("rows",e.i5U(13,15,s.userData,s.searchData))("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight","auto")("limit",s.pageSize)("loadingIndicator",s.loading)("scrollbarH",!0)("rowClass",s.isActiveRow)("messages",e.lJ4(18,Y)),e.R7$(7),e.Y8G("ngIf",s.IsEditPermission||s.IsDeletePermission),e.R7$(),e.Y8G("pageSize",s.pageSize)("pageIndex",s.pageIndex-1)("length",s.totalItems))},dependencies:[p.bT,f.It,E.An,h.Wk,U.ge,U.ed,U.QI,C.iy,p.vh,B.j],styles:[".ngx-datatable .datatable-header-cell{background-color:#17bb58!important;color:#fff!important}.icon-green[_ngcontent-%COMP%]{color:green}.btn[_ngcontent-%COMP%]{background-color:#17bb58!important;color:#fff!important}  .ngx-datatable.material .datatable-body .progress-linear .container{background-color:#90ee90}  .ngx-datatable.material .datatable-body .progress-linear .container .bar{background-color:green}"]})}return i})();o(9239);let D=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["ng-component"]],decls:1,vars:0,template:function(r,s){1&r&&e.nrm(0,"router-outlet")},dependencies:[h.n3],encapsulation:2})}return i})();var S=o(6441);const ee=[{path:"",component:D,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",canActivate:[S.L],data:{permission:"User (PER_USER) - View"},component:j},{path:"add",canActivate:[S.L],data:{permission:"User (PER_USER) - Add"},component:b},{path:"edit/:id",canActivate:[S.L],data:{permission:"User (PER_USER) - Edit"},component:b}]}];let te=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.$C({type:i});static#s=this.\u0275inj=e.G2t({imports:[h.iI.forChild(ee),h.iI]})}return i})();var se=o(9159);let re=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.$C({type:i});static#s=this.\u0275inj=e.G2t({providers:[g,I.W,(0,y._c)()],imports:[u.Gg,te,se.tP,C.Ou]})}return i})()}}]);