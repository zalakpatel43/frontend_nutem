"use strict";(self.webpackChunkskyward_admin=self.webpackChunkskyward_admin||[]).push([[998],{14998:(et,v,n)=>{n.r(v),n.d(v,{WorkflowModule:()=>z});var T=n(71774),m=n(18498),t=n(54438);let g=(()=>{class o{static#t=this.\u0275fac=function(s){return new(s||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ng-component"]],decls:1,vars:0,template:function(s,r){1&s&&t.nrm(0,"router-outlet")},dependencies:[m.n3],encapsulation:2})}return o})();var l=n(89417),c=n(4434);let p=(()=>{class o extends c.QP{constructor(e){super(e,"workflow"),this._baseService=e}generateWorkflowCode(){return this._baseService.get(`${c.T6.workflow}/GenerateCode`)}getUsers(){return this._baseService.get(`${c.T6.account}`)}static#t=this.\u0275fac=function(s){return new(s||o)(t.KVO(c.dD))};static#e=this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac})}return o})();var b=n(45794),_=n(56102),W=n(60177),f=n(88834),u=n(32102),L=n(99631),C=n(99213),E=n(82798),S=n(86600),w=n(25084),y=n(30220),D=n(58777),I=n(67133);function G(o,d){if(1&o){const e=t.RV6();t.j41(0,"a",31),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.cancel())}),t.EFF(1," View List "),t.k0s()}}function N(o,d){if(1&o&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&o){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function R(o,d){if(1&o&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&o){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function $(o,d){if(1&o&&(t.j41(0,"mat-option",32),t.EFF(1),t.k0s()),2&o){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.E5c(" ",e.firstName," ",e.lastName," - ",e.email," ")}}function A(o,d){if(1&o){const e=t.RV6();t.j41(0,"div",33)(1,"div",34)(2,"mat-form-field")(3,"mat-label"),t.EFF(4,"Level No"),t.k0s(),t.nrm(5,"input",35)(6,"mat-validation-message",18),t.k0s()(),t.j41(7,"div",16)(8,"mat-form-field")(9,"mat-label"),t.EFF(10,"Approver Type"),t.k0s(),t.j41(11,"mat-select",36),t.bIt("selectionChange",function(r){const a=t.eBV(e).index,i=t.XpG();return t.Njj(i.onApproverTypeChange(r,a))}),t.DNE(12,R,2,2,"mat-option",22),t.k0s(),t.nrm(13,"mat-validation-message",18),t.k0s()(),t.j41(14,"div",16)(15,"mat-form-field")(16,"mat-label"),t.EFF(17,"Users"),t.k0s(),t.j41(18,"mat-select",37),t.DNE(19,$,2,4,"mat-option",22),t.k0s(),t.nrm(20,"mat-validation-message",18),t.k0s()(),t.j41(21,"div",38)(22,"button",39),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.addWorkflowLevel())}),t.j41(23,"mat-icon"),t.EFF(24,"add"),t.k0s()(),t.j41(25,"button",39),t.bIt("click",function(){const r=t.eBV(e).index,a=t.XpG();return t.Njj(a.removeWorkflowLevel(r))}),t.j41(26,"mat-icon"),t.EFF(27,"delete"),t.k0s()()()()}if(2&o){const e=d.$implicit,s=d.index,r=t.XpG();t.Y8G("formGroupName",s),t.R7$(6),t.Y8G("control",e.get("levelNo"))("message","Level No")("formSubmitted",r.isFormSubmitted),t.R7$(6),t.Y8G("ngForOf",r.approverTypes),t.R7$(),t.Y8G("control",e.get("approverTypeId"))("message","Approver Type")("formSubmitted",r.isFormSubmitted),t.R7$(5),t.Y8G("disabled",r.isSupervisorWise(e)),t.R7$(),t.Y8G("ngForOf",r.users),t.R7$(),t.Y8G("control",e.get("userIds"))("message","Users")("formSubmitted",r.isFormSubmitted)}}let k=(()=>{class o{constructor(e,s,r,a,i,q,tt){this.fb=e,this.activatedRoute=s,this.router=r,this.workflowService=a,this.listService=i,this.toastr=q,this.moduleGroupService=tt,this.isEditMode=!1,this.isFormSubmitted=!1,this.page=c.Wt.workflow,this.permissions=c.eZ,this.transactions=[],this.approverTypes=[],this.users=[],this.createForm()}ngOnInit(){this.loadDropdowns(),this.getWorkflowRoute()}createForm(){this.frmWorkflow=this.fb.group({workflowCode:[{value:"",disabled:!0},[l.k0.required,l.k0.maxLength(32)]],workflowDate:[new Date,[l.k0.required]],transactionId:[null,l.k0.required],remarks:[""],isActive:[!0],workflowLevels:this.fb.array([])})}getWorkflowRoute(){this.routerSub=this.activatedRoute.params.subscribe(e=>{this.isEditMode=!c.ov.isEmpty(e.id),this.createForm(),this.isEditMode?(this.workflowId=+e.id,this.getWorkflowDetails(this.workflowId)):this.generateWorkflowCode()})}generateWorkflowCode(){this.workflowService.generateWorkflowCode().subscribe(e=>{this.frmWorkflow.patchValue({workflowCode:e})},e=>{console.log(e)})}get workflowLevels(){return this.frmWorkflow.get("workflowLevels")}addWorkflowLevel(e){this.workflowLevels.push(this.fb.group({levelNo:[e?e.levelNo:this.workflowLevels.length+1,[l.k0.required,l.k0.min(1),l.k0.max(99)]],approverTypeId:[e?e.approverTypeId:null,l.k0.required],userIds:[e?e.userIds:[],l.k0.required]}))}removeWorkflowLevel(e){this.workflowLevels.removeAt(e)}loadDropdowns(){this.moduleGroupService.getModuleGroupList().subscribe(e=>{this.transactions=e}),this.listService.getList("approvertypes").subscribe(e=>{this.approverTypes=e}),this.workflowService.getUsers().subscribe(e=>{this.users=e})}getWorkflowDetails(e){this.workflowService.getById(e).subscribe(s=>{this.workflowData=s,this.workflowData.workflowLevels.forEach(r=>{r.userIds=r.workflowUsers.map(a=>a.userId)}),this.setWorkflowData()})}setWorkflowData(){this.frmWorkflow.patchValue(this.workflowData),this.workflowData.workflowLevels.forEach(e=>this.addWorkflowLevel(e))}onApproverTypeChange(e,s){const r=this.approverTypes.find(i=>i.id===e.value),a=this.workflowLevels.at(s).get("userIds");r&&"Supervisor Wise"===r.name?(a.setValue([]),a.disable()):a.enable()}isSupervisorWise(e){const s=this.approverTypes.find(r=>r.id===e.get("approverTypeId").value);return s&&"Supervisor Wise"===s.name}createWorkflow(){let e=this.frmWorkflow.getRawValue();e.workflowLevels.forEach(a=>{a.workflowUsers=[],a.userIds.forEach(i=>{a.workflowUsers.push({userId:i})})});let r,s=!1;for(let a=0;a<e.workflowLevels.length;a++)for(let i=a+1;i<e.workflowLevels.length;i++)if(e.workflowLevels[a].levelNo===e.workflowLevels[i].levelNo){s=!0,r=e.workflowLevels[a].levelNo;break}s?this.toastr.warning(`Level# ${r} specified more than once.`):this.workflowService.add(e).subscribe(()=>{this.cancel(),this.toastr.success("Workflow added successfully.")},a=>{this.error=a,this.toastr.warning("Something went wrong. Please try again.")})}updateWorkflow(){let e=this.frmWorkflow.getRawValue();this.workflowData=Object.assign(this.workflowData,this.workflowData,e),e.workflowLevels.forEach(a=>{a.workflowUsers=[],a.userIds.forEach(i=>{a.workflowUsers.push({userId:i})})});let r,s=!1;for(let a=0;a<e.workflowLevels.length;a++)for(let i=a+1;i<e.workflowLevels.length;i++)if(e.workflowLevels[a].levelNo===e.workflowLevels[i].levelNo){s=!0,r=e.workflowLevels[a].levelNo;break}s?this.toastr.warning(`Level# ${r} specified more than once.`):this.workflowService.update(this.workflowData.id,this.workflowData).subscribe(()=>{this.cancel(),this.toastr.success("Workflow updated successfully.")},a=>{this.error=a,this.toastr.warning("Something went wrong. Please try again.")})}setValidators(){this.workflowLevels.controls.forEach((e,s)=>{const r=this.approverTypes.find(i=>i.id===e.get("approverTypeId").value),a=e.get("userIds");a&&r&&"Supervisor Wise"===r.name?(a.setValue([]),a.disable()):a.enable()})}save(){this.isFormSubmitted=!0,this.setValidators(),!this.frmWorkflow.invalid&&(this.isEditMode?this.updateWorkflow():this.createWorkflow())}cancel(){this.router.navigate(this.isEditMode?["../..","list"]:["..","list"],{relativeTo:this.activatedRoute})}ngOnDestroy(){this.routerSub.unsubscribe()}static#t=this.\u0275fac=function(s){return new(s||o)(t.rXU(l.ze),t.rXU(m.nX),t.rXU(m.Ix),t.rXU(p),t.rXU(c.aG),t.rXU(b.tw),t.rXU(_.T))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-workflow-add-edit"]],decls:59,vars:18,consts:[["form","ngForm"],["picker",""],[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center","mb-4"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end"],[1,"mb-0"],[1,"icon-edit"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end"],["mat-flat-button","","color","primary","class","app-button",3,"click",4,"authPermission"],["novalidate","",1,"app-form",3,"submit","formGroup"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-md-4"],["type","text","matInput","","formControlName","workflowCode"],[3,"control","message","formSubmitted"],["matInput","","formControlName","workflowDate",3,"matDatepicker"],["matSuffix","",3,"for"],["formControlName","transactionId"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-12"],["matInput","","formControlName","remarks"],[1,"card-header","d-flex","align-items-center","justify-content-between"],["type","button","mat-flat-button","","color","primary",3,"click"],["formArrayName","workflowLevels"],["class","row mt-3",3,"formGroupName",4,"ngFor","ngForOf"],[1,"col-lg-12","text-center"],["type","submit","mat-flat-button","","color","primary",1,"app-button","mr-1"],["mat-flat-button","","color","primary",1,"app-button",3,"click"],[3,"value"],[1,"row","mt-3",3,"formGroupName"],[1,"col-md-3"],["type","number","matInput","","formControlName","levelNo"],["formControlName","approverTypeId",3,"selectionChange"],["formControlName","userIds","multiple","",3,"disabled"],[1,"col-md-1","d-flex","align-items-center"],["type","button","mat-icon-button","","color","warn",3,"click"]],template:function(s,r){if(1&s){const a=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"h4",7),t.nrm(6,"i",8),t.EFF(7," Add/Edit Workflow"),t.k0s()(),t.j41(8,"div",9),t.DNE(9,G,2,0,"a",10),t.k0s()(),t.j41(10,"form",11,0),t.bIt("submit",function(){return t.eBV(a),t.Njj(r.save())}),t.j41(12,"div",12)(13,"div",13)(14,"h5",7),t.EFF(15,"Basic Details"),t.k0s()(),t.j41(16,"div",14)(17,"div",15)(18,"div",16)(19,"mat-form-field")(20,"mat-label"),t.EFF(21,"Workflow Code"),t.k0s(),t.nrm(22,"input",17)(23,"mat-validation-message",18),t.k0s()(),t.j41(24,"div",16)(25,"mat-form-field")(26,"mat-label"),t.EFF(27,"Workflow Date"),t.k0s(),t.nrm(28,"input",19)(29,"mat-datepicker-toggle",20)(30,"mat-datepicker",null,1)(32,"mat-validation-message",18),t.k0s()(),t.j41(33,"div",16)(34,"mat-form-field")(35,"mat-label"),t.EFF(36,"Transaction"),t.k0s(),t.j41(37,"mat-select",21),t.DNE(38,N,2,2,"mat-option",22),t.k0s(),t.nrm(39,"mat-validation-message",18),t.k0s()(),t.j41(40,"div",23)(41,"mat-form-field")(42,"mat-label"),t.EFF(43,"Remarks"),t.k0s(),t.nrm(44,"textarea",24)(45,"mat-validation-message",18),t.k0s()()()()(),t.j41(46,"div",12)(47,"div",25)(48,"h5",7),t.EFF(49,"Workflow Levels"),t.k0s(),t.j41(50,"button",26),t.bIt("click",function(){return t.eBV(a),t.Njj(r.addWorkflowLevel())}),t.EFF(51,"Add Level"),t.k0s()(),t.j41(52,"div",14)(53,"div",27),t.DNE(54,A,28,13,"div",28),t.k0s()()(),t.j41(55,"div",15)(56,"div",29)(57,"button",30),t.EFF(58,"Save"),t.k0s()()()()()()()}if(2&s){const a=t.sdS(31);t.R7$(9),t.Y8G("authPermission",r.page+"_"+r.permissions.list),t.R7$(),t.Y8G("formGroup",r.frmWorkflow),t.R7$(13),t.Y8G("control",r.frmWorkflow.controls.workflowCode)("message","Workflow Code")("formSubmitted",r.isFormSubmitted),t.R7$(5),t.Y8G("matDatepicker",a),t.R7$(),t.Y8G("for",a),t.R7$(3),t.Y8G("control",r.frmWorkflow.controls.workflowDate)("message","Workflow Date")("formSubmitted",r.isFormSubmitted),t.R7$(6),t.Y8G("ngForOf",r.transactions),t.R7$(),t.Y8G("control",r.frmWorkflow.controls.transactionId)("message","Transaction")("formSubmitted",r.isFormSubmitted),t.R7$(6),t.Y8G("control",r.frmWorkflow.controls.remarks)("message","Remarks")("formSubmitted",r.isFormSubmitted),t.R7$(9),t.Y8G("ngForOf",r.workflowLevels.controls)}},dependencies:[W.Sq,l.qT,l.me,l.Q0,l.BC,l.cb,l.j4,l.JD,l.$R,l.v8,f.It,f.$z,f.iY,u.rl,u.nJ,u.yw,L.fg,C.An,E.VO,S.wT,w.Vh,w.bZ,w.bU,y.B,D.T,I.r],styles:[".card[_ngcontent-%COMP%]{margin-bottom:1.5rem;box-shadow:0 1px 3px #0000001a}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef;padding:.75rem 1.25rem}.card-body[_ngcontent-%COMP%]{padding:1.25rem}.mat-icon[_ngcontent-%COMP%]{vertical-align:middle}"]})}return o})();var h=n(33380),x=n(49239),Y=n(74193);let F=(()=>{class o{constructor(){this.searchChanged=new t.bkB,this.searchData={},this.searchKey="workflowCode,transactionName,remarks"}updateSearchTerms(e,s){this.searchData[e]=s,this.searchChanged.emit(this.searchData)}static#t=this.\u0275fac=function(s){return new(s||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["workflow-search-panel"]],outputs:{searchChanged:"searchChanged"},decls:5,vars:1,consts:[[1,"row"],[1,"col-lg-6"],[3,"textSearchEntered","placeHolder"],[1,"col-lg-4"],[3,"chkChanged"]],template:function(s,r){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"search-text",2),t.bIt("textSearchEntered",function(i){return r.updateSearchTerms(r.searchKey,i)}),t.k0s()(),t.j41(3,"div",3)(4,"search-inactive",4),t.bIt("chkChanged",function(i){return r.updateSearchTerms("isActive",i)}),t.k0s()()()),2&s&&(t.R7$(2),t.Y8G("placeHolder","Search Workflow Code, Transaction, Remarks"))},dependencies:[x.D,Y.$],encapsulation:2})}return o})();var V=n(96081);const U=()=>({emptyMessage:"No Data to Display",totalMessage:"Total"}),X=()=>["../","add"],P=o=>["..","edit",o];function B(o,d){1&o&&(t.j41(0,"a",18)(1,"span"),t.EFF(2,"Add New"),t.k0s(),t.nrm(3,"i",19),t.k0s()),2&o&&t.Y8G("routerLink",t.lJ4(1,X))}function M(o,d){if(1&o&&(t.j41(0,"a",22)(1,"mat-icon"),t.EFF(2,"edit"),t.k0s()()),2&o){const e=t.XpG().row;t.Y8G("routerLink",t.eq3(1,P,e.id))}}function O(o,d){if(1&o){const e=t.RV6();t.j41(0,"a",25),t.bIt("click",function(){t.eBV(e);const r=t.XpG(2).row,a=t.XpG();return t.Njj(a.activateToggleWorkflow(r,!1))}),t.j41(1,"mat-icon"),t.EFF(2,"lock"),t.k0s()()}}function H(o,d){if(1&o){const e=t.RV6();t.j41(0,"a",25),t.bIt("click",function(){t.eBV(e);const r=t.XpG(2).row,a=t.XpG();return t.Njj(a.activateToggleWorkflow(r,!0))}),t.j41(1,"mat-icon"),t.EFF(2,"lock_open"),t.k0s()()}}function Z(o,d){if(1&o&&(t.qex(0,23),t.DNE(1,O,3,0,"a",24)(2,H,3,0,"a",24),t.bVm()),2&o){const e=t.XpG().row;t.R7$(),t.Y8G("ngIf",e.isActive),t.R7$(),t.Y8G("ngIf",!e.isActive)}}function J(o,d){if(1&o&&t.DNE(0,M,3,3,"a",20)(1,Z,3,2,"ng-container",21),2&o){const e=t.XpG();t.Y8G("authPermission",e.page+"_"+e.permissions.edit),t.R7$(),t.Y8G("authPermission",e.page+"_"+e.permissions.active)}}const K=[{path:"",component:g,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:(()=>{class o{constructor(e,s){this.workflowService=e,this.toastr=s,this.workflowData=[],this.page=c.Wt.workflow,this.permissions=c.eZ,this.searchData={isActive:!1}}ngOnInit(){this.getWorkflowData()}getWorkflowData(){this.loading=!0,this.workflowService.get().subscribe(e=>{this.workflowData=e,this.loading=!1},e=>{console.log(e),this.loading=!1})}activateToggleWorkflow(e,s){confirm(`Are you sure you want to ${s?"Activate":"Deactivate"} this workflow?`)&&this.workflowService.toggleActivate(e.id,s).subscribe(()=>{this.getWorkflowData()},a=>{this.toastr.error("Something went wrong.")})}updateSearch(e){this.searchData=Object.assign({},e)}isActiveRow(e){return{"text-danger":!e.isActive}}static#t=this.\u0275fac=function(s){return new(s||o)(t.rXU(p),t.rXU(b.tw))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-workflow-list"]],decls:20,vars:16,consts:[[1,"row","justify-content-center"],[1,"col-xl-11","col-lg-12"],[1,"border","p30","rounded"],[1,"row","align-items-center"],[1,"col-lg-7","col-sm-9","col-xs-10","d-flex","align-items-end","leftSideHeader"],[1,"mb20","float-left"],[1,"col-lg-5","col-sm-3","col-xs-2","d-flex","justify-content-end","rightSideHeader","mb10"],["mat-flat-button","","color","primary","class","app-button",3,"routerLink",4,"authPermission"],[1,"row"],[1,"col-12"],[3,"searchChanged"],[1,"material",3,"rows","columnMode","headerHeight","footerHeight","rowHeight","limit","loadingIndicator","scrollbarH","rowClass","messages"],["name","Workflow Code","prop","workflowCode"],["name","Workflow Date","prop","workflowDate"],["name","Transaction","prop","transactionName"],["name","Remarks","prop","remarks"],["name","Actions",3,"sortable"],["ngx-datatable-cell-template",""],["mat-flat-button","","color","primary",1,"app-button",3,"routerLink"],[1,"icon-plus"],["class","button-padding","color","primary",3,"routerLink",4,"authPermission"],["class","ml-10",4,"authPermission"],["color","primary",1,"button-padding",3,"routerLink"],[1,"ml-10"],["class","button-padding","color","primary",3,"click",4,"ngIf"],["color","primary",1,"button-padding",3,"click"]],template:function(s,r){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),t.EFF(6,"Workflow List"),t.k0s()(),t.j41(7,"div",6),t.DNE(8,B,4,2,"a",7),t.k0s()(),t.j41(9,"div",8)(10,"div",9)(11,"workflow-search-panel",10),t.bIt("searchChanged",function(i){return r.updateSearch(i)}),t.k0s(),t.j41(12,"ngx-datatable",11),t.nI1(13,"searchtable"),t.nrm(14,"ngx-datatable-column",12)(15,"ngx-datatable-column",13)(16,"ngx-datatable-column",14)(17,"ngx-datatable-column",15),t.j41(18,"ngx-datatable-column",16),t.DNE(19,J,2,2,"ng-template",17),t.k0s()()()()()()()),2&s&&(t.R7$(8),t.Y8G("authPermission",r.page+"_"+r.permissions.create),t.R7$(4),t.Y8G("rows",t.i5U(13,12,r.workflowData,r.searchData))("columnMode","force")("headerHeight",50)("footerHeight",50)("rowHeight","auto")("limit",10)("loadingIndicator",r.loading)("scrollbarH",!0)("rowClass",r.isActiveRow)("messages",t.lJ4(15,U)),t.R7$(6),t.Y8G("sortable",!1))},dependencies:[W.bT,f.It,C.An,m.Wk,h.ge,h.ed,h.QI,y.B,F,V.j],encapsulation:2})}return o})(),canActivate:[c.LL],data:{page:c.Wt.workflow,action:c.eZ.list,title:"Workflow"}},{path:"add",canActivate:[c.LL],data:{page:c.Wt.workflow,action:c.eZ.create,title:"Workflow"},component:k},{path:"edit/:id",canActivate:[c.LL],data:{page:c.Wt.workflow,action:c.eZ.edit,title:"Workflow"},component:k}]}];let Q=(()=>{class o{static#t=this.\u0275fac=function(s){return new(s||o)};static#e=this.\u0275mod=t.$C({type:o});static#o=this.\u0275inj=t.G2t({imports:[m.iI.forChild(K),m.iI]})}return o})(),z=(()=>{class o{static#t=this.\u0275fac=function(s){return new(s||o)};static#e=this.\u0275mod=t.$C({type:o});static#o=this.\u0275inj=t.G2t({providers:[p,_.T],imports:[T.Gg,Q]})}return o})()}}]);